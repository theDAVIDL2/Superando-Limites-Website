name: Deployment Status

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  status-check:
    name: ðŸ“Š Deployment Overview
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: ðŸ” Detect changes
        id: changes
        run: |
          echo "Analyzing changes..."
          
          FRONTEND_CHANGED=$(git diff --name-only HEAD^ HEAD | grep '^frontend/' | grep -v '^frontend/README.md' | grep -v '^frontend/docs/' || echo "")
          BACKEND_CHANGED=$(git diff --name-only HEAD^ HEAD | grep '^backend/' | grep -v '^backend/README.md' || echo "")
          DOCS_ONLY=$(git diff --name-only HEAD^ HEAD | grep -E '\.md$|^DOCS/|^docs/' || echo "")
          
          echo "frontend_changed=$( [ -n "$FRONTEND_CHANGED" ] && echo 'true' || echo 'false' )" >> $GITHUB_OUTPUT
          echo "backend_changed=$( [ -n "$BACKEND_CHANGED" ] && echo 'true' || echo 'false' )" >> $GITHUB_OUTPUT
          echo "docs_only=$( [ -z "$FRONTEND_CHANGED" ] && [ -z "$BACKEND_CHANGED" ] && [ -n "$DOCS_ONLY" ] && echo 'true' || echo 'false' )" >> $GITHUB_OUTPUT
          
          echo ""
          echo "Frontend changed: $( [ -n "$FRONTEND_CHANGED" ] && echo 'YES' || echo 'NO' )"
          echo "Backend changed: $( [ -n "$BACKEND_CHANGED" ] && echo 'YES' || echo 'NO' )"
          echo "Docs only: $( [ -z "$FRONTEND_CHANGED" ] && [ -z "$BACKEND_CHANGED" ] && [ -n "$DOCS_ONLY" ] && echo 'YES' || echo 'NO' )"

      - name: ðŸ“Š Deployment summary
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ðŸš€ DEPLOYMENT STATUS REPORT"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ðŸ“ Commit: ${{ github.sha }}"
          echo "ðŸ‘¤ Author: ${{ github.actor }}"
          echo "ðŸ’¬ Message: ${{ github.event.head_commit.message }}"
          echo "ðŸŒ¿ Branch: ${{ github.ref_name }}"
          echo "ðŸ• Time: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ðŸ“¦ COMPONENTS STATUS"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          
          if [ "${{ steps.changes.outputs.frontend_changed }}" == "true" ]; then
            echo "ðŸŽ¨ FRONTEND: âœ… Changes detected â†’ Build triggered"
            echo "   - Workflow: frontend-deployment.yml"
            echo "   - Status: Building..."
          else
            echo "ðŸŽ¨ FRONTEND: â­ï¸ No changes"
          fi
          
          echo ""
          
          if [ "${{ steps.changes.outputs.backend_changed }}" == "true" ]; then
            echo "ðŸ”§ BACKEND: âœ… Changes detected â†’ Build triggered"
            echo "   - Workflow: backend-deployment.yml"
            echo "   - Status: Testing & building..."
          else
            echo "ðŸ”§ BACKEND: â­ï¸ No changes"
          fi
          
          echo ""
          
          if [ "${{ steps.changes.outputs.docs_only }}" == "true" ]; then
            echo "ðŸ“š DOCUMENTATION: âœ… Updated"
            echo "   - No deployment needed"
          fi
          
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ðŸ”— QUICK LINKS"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ðŸ“ Actions: https://github.com/${{ github.repository }}/actions"
          echo "ðŸ“ Deployments: https://github.com/${{ github.repository }}/deployments"
          echo "ðŸ“ This Run: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          echo ""

      - name: ðŸ“ Create summary
        run: |
          echo "## ðŸš€ Deployment Status" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Commit:** \`${{ github.sha }}\`" >> $GITHUB_STEP_SUMMARY
          echo "**Author:** ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "**Branch:** ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ steps.changes.outputs.frontend_changed }}" == "true" ]; then
            echo "### ðŸŽ¨ Frontend" >> $GITHUB_STEP_SUMMARY
            echo "âœ… Changes detected - Build workflow triggered" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ "${{ steps.changes.outputs.backend_changed }}" == "true" ]; then
            echo "### ðŸ”§ Backend" >> $GITHUB_STEP_SUMMARY
            echo "âœ… Changes detected - Test & build workflow triggered" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ "${{ steps.changes.outputs.docs_only }}" == "true" ]; then
            echo "### ðŸ“š Documentation" >> $GITHUB_STEP_SUMMARY
            echo "â„¹ï¸ Documentation updated (no deployment needed)" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**ðŸ“ [View All Deployments](https://github.com/${{ github.repository }}/deployments)**" >> $GITHUB_STEP_SUMMARY

      - name: ðŸŽ¯ Status badge update
        run: |
          echo "Status tracking complete âœ…"

